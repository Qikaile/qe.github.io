// build time:Tue Apr 21 2020 13:57:40 GMT+0800 (GMT+08:00)
(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e);else e(CodeMirror)})(function(e){"use strict";function r(e,r){if(typeof e=="string")e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r?"gi":"g");else if(!e.global)e=new RegExp(e.source,e.ignoreCase?"gi":"g");return{token:function(r){e.lastIndex=r.pos;var o=e.exec(r.string);if(o&&o.index==r.pos){r.pos+=o[0].length;return"searching"}else if(o){r.pos=o.index}else{r.skipToEnd()}}}}function o(){this.posFrom=this.posTo=this.query=null;this.overlay=null}function n(e){return e.state.search||(e.state.search=new o)}function t(e){return typeof e=="string"&&e==e.toLowerCase()}function i(e,r,o){return e.getSearchCursor(r,o,t(r))}function a(e,r,o,n,t){if(e.openDialog)e.openDialog(r,t,{value:n});else t(prompt(o,n))}function c(e,r,o,n){if(e.openConfirm)e.openConfirm(r,n);else if(confirm(o))n[0]()}function s(e){var r=e.match(/^\/(.*)\/([a-z]*)$/);if(r){try{e=new RegExp(r[1],r[2].indexOf("i")==-1?"":"i")}catch(o){}}if(typeof e=="string"?e=="":e.test(""))e=/x^/;return e}var f='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';function l(e,o){var i=n(e);if(i.query)return u(e,o);a(e,f,"Search for:",e.getSelection(),function(n){e.operation(function(){if(!n||i.query)return;i.query=s(n);e.removeOverlay(i.overlay,t(i.query));i.overlay=r(i.query,t(i.query));e.addOverlay(i.overlay);if(e.showMatchesOnScrollbar){if(i.annotate){i.annotate.clear();i.annotate=null}i.annotate=e.showMatchesOnScrollbar(i.query,t(i.query))}i.posFrom=i.posTo=e.getCursor();u(e,o)})})}function u(r,o){r.operation(function(){var t=n(r);var a=i(r,t.query,o?t.posFrom:t.posTo);if(!a.find(o)){a=i(r,t.query,o?e.Pos(r.lastLine()):e.Pos(r.firstLine(),0));if(!a.find(o))return}r.setSelection(a.from(),a.to());r.scrollIntoView({from:a.from(),to:a.to()});t.posFrom=a.from();t.posTo=a.to()})}function p(e){e.operation(function(){var r=n(e);if(!r.query)return;r.query=null;e.removeOverlay(r.overlay);if(r.annotate){r.annotate.clear();r.annotate=null}})}var d='Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';var m='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>';var y="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function h(e,r){if(e.getOption("readOnly"))return;a(e,d,"Replace:",e.getSelection(),function(o){if(!o)return;o=s(o);a(e,m,"Replace with:","",function(n){if(r){e.operation(function(){for(var r=i(e,o);r.findNext();){if(typeof o!="string"){var t=e.getRange(r.from(),r.to()).match(o);r.replace(n.replace(/\$(\d)/g,function(e,r){return t[r]}))}else r.replace(n)}})}else{p(e);var t=i(e,o,e.getCursor());var a=function(){var r=t.from(),n;if(!(n=t.findNext())){t=i(e,o);if(!(n=t.findNext())||r&&t.from().line==r.line&&t.from().ch==r.ch)return}e.setSelection(t.from(),t.to());e.scrollIntoView({from:t.from(),to:t.to()});c(e,y,"Replace?",[function(){s(n)},a])};var s=function(e){t.replace(typeof o=="string"?n:n.replace(/\$(\d)/g,function(r,o){return e[o]}));a()};a()}})})}e.commands.find=function(e){p(e);l(e)};e.commands.findNext=l;e.commands.findPrev=function(e){l(e,true)};e.commands.clearSearch=p;e.commands.replace=h;e.commands.replaceAll=function(e){h(e,true)}});
//rebuild by neat 